<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mike's Page</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  </head>
  <body>
    <form class="pure-form pure-form-stacked" name="answer" method="POST" action="/.netlify/functions/save_answer">
        <fieldset>
          <legend>Mike's Page</legend>
            <label for="answer">Answer:</label>
            <textarea id="answer" name="answer" placeholder="Type your answer here" rows="4" cols="30" required="required"></textarea>
    
            <label for="who">Send it to:</label>
            <select id="who" name="who" required="required">
                <option disabled selected value></option>
                <option>Andrew</option>
                <option>Anthony</option>
                <option>Clare</option>
                <option>Julia</option>
                <option>Katie</option>
                
              </select>

            <input type="hidden" name="postedBy" value="Mike"/>
    
            <button type="submit" class="pure-button pure-button-primary">Send answer</button>
        </fieldset>
    </form>

    <div id="app">
      <ol>
        <li v-for="item in message">
          
            {{ item.answer }}
          
        </li>
      </ol>
    </div>

    <script>
      var app = new Vue({
        el: '#app',
        data () {
	        return {
		        message: null
	        }
        },
        methods: {
          pollData () {
            setInterval(() => {
              fetch('/.netlify/functions/get_answer?for=Mike')
                .then((response) => {
                  return response.json();
                })
                .then((data) => {
                  this.message = data.sort(function(a, b) {
                    var keyA = new Date(a.createdat), keyB = new Date(b.createdat);
                    // Compare the 2 dates
                    if (keyA < keyB) return -1;
                    if (keyA > keyB) return 1;
                    return 0;
                  });
                });
            }, 3000)
          }
        },
        beforeDestroy () {
          clearInterval(this.polling)
        },
        created () {
          this.pollData()
        }
      })
    </script>
  </body>
</html>
